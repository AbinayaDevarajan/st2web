<header class="st2-menu"></header>

<main class="st2-panel">

  <div class="st2-panel__view st2-rules">
    <div class="st2-panel__scroller">

      <div class="st2-panel__toolbar">
        <div class="st2-panel__toolbar-title">
          Rules
        </div>

        <div class="st2-panel__toolbar-search"
            ng-show="rules">
          <form>
            <input type="search"
              class="st2-panel__search-bar"
              placeholder="Filter"
              ng-model="filter">
          </form>
        </div>
      </div>

      <div class="st2-panel__content">

        <div class="st2-flex-table"
            ng-if="rules && !_.isEmpty(rules)">
          <div class="st2-flex-table__caption"
              ng-click="toggle()">
            <h2 class="st2-flex-table__caption-title">General</h2>
          </div>

          <div class="st2-flex-table__header">
            <div class="st2-flex-table__column st2-rules__column-enabled">Enabled</div>
            <div class="st2-flex-table__column st2-rules__column-name">Name</div>
            <div class="st2-flex-table__column st2-rules__column-desc">Description</div>
            <div class="st2-flex-table__column st2-rules__column-trigger">Trigger</div>
            <div class="st2-flex-table__column st2-rules__column-action">Action Name</div>
          </div>

          <div class="st2-flex-table__row"
              ng-class-odd="'st2-flex-table__row--odd'"
              ng-class-even="'st2-flex-table__row--even'"
              ng-class="{'st2-flex-table__row--active': rule.id == $parent.rule.id}"
              ng-repeat="rule in rules"
              ng-click="$root.go({id: rule.id, edit: undefined})">
            <div class="st2-flex-table__column st2-rules__column-enabled">
              <span class="st2-label" status="rule.enabled && 'enabled' || 'disabled'"></span>
            </div>
            <div class="st2-flex-table__column st2-rules__column-name"
                title="{{ rule.name }}">
              {{ rule.name }}
            </div>
            <div class="st2-flex-table__column st2-rules__column-desc">
              {{ rule.description }}
            </div>
            <div class="st2-flex-table__column st2-rules__column-trigger"
                title="{{ rule.trigger.type }}">
              {{ rule.trigger.type }}
            </div>
            <div class="st2-flex-table__column st2-rules__column-action"
                title="{{ rule.action.ref }}">
              {{ rule.action.ref }}
            </div>
          </div>
        </div>

        <div class="st2-panel__content-empty"
            ng-if="rules && _.isEmpty(rules)">
          No results were found for your current filter
        </div>

        <div class="st2-panel__content-error"
            ng-if="error && _.isEmpty(groups)">
          <p class="st2-panel__content-error-title">Unable to reach API server</p>
          <p>Check developer console of your browser for more info.</p>
        </div>
      </div>
    </div>

    <div class="st2-loader"></div>
  </div>

  <div class="st2-panel__details st2-details"
      ng-show="rule">

    <form class="st2-details__form"
        ng-submit="submit()"
        name="form">

      <div class="st2-details__header">
        <div class="st2-details__header-name">
          <span class="st2-label" status="rule.enabled && 'enabled' || 'disabled'"></span>
          <a ui-sref="rules.general({id: rule.id})">
            {{ rule.name }}
          </a>
        </div>
        <div class="st2-details__header-description">{{ rule.description }}</div>
      </div>

      <div class="st2-details__toolbar">
        <input type="button"
            class="st2-forms__button st2-forms__button--small st2-details__toolbar-button"
            ng-click="edit()"
            ng-hide="$root.state.params.edit"
            value="Edit"/>
        <input type="button"
            class="st2-forms__button st2-forms__button--small st2-details__toolbar-button"
            ng-hide="$root.state.params.edit"
            value="Duplicate"/>
        <input type="button"
            class="st2-forms__button st2-forms__button--small st2-details__toolbar-button"
            ng-hide="$root.state.params.edit"
            value="Delete"/>

        <input type="submit"
            class="st2-forms__button st2-forms__button--small st2-details__toolbar-button"
            ng-show="$root.state.params.edit"
            ng-disabled="form.$pristine || form.$invalid"
            value="Save"/>
        <input type="button"
            class="st2-forms__button st2-forms__button--small st2-details__toolbar-button"
            ng-click="cancel()"
            ng-show="$root.state.params.edit"
            value="Cancel"/>

        <div class="st2-details__toolbar-separator"></div>

        <div class="st2-details__switch st2-details__switch--of-two"
            ng-class="{
              'st2-details__switch--first': $root.isState(['^.general', '^.list']),
              'st2-details__switch--second': $root.isState('^.code')
            }">
          <div class="st2-details__switch-item"
              ng-click="$root.state.go('^.general', $root.state.params)">
            <i class="st2-icon__cogs"></i>
          </div>
          <div class="st2-details__switch-item"
              ng-click="$root.state.go('^.code', $root.state.params)">
            <i class="st2-icon__code"></i>
          </div>
        </div>

      </div>

      <div class="st2-details__body"
          ng-class="{'st2-details__body--active': $root.isState(['^.general', '^.list'])}">
        <div class="st2-panel__scroller">

          <div class="st2-details__panel"
              ng-show="$root.state.params.edit">
            <div class="st2-details__panel-heading">
              <h2 class="st2-details__panel-title">Rule</h2>
            </div>
            <div class="st2-manual-form st2-form-input"
              name="name"
              spec="{
                pattern: '^[\\w.-]+$',
                required: true
              }"
              ng-model="rule.name">
            </div>
            <div class="st2-manual-form st2-form-input"
              name="description"
              ng-model="rule.description">
            </div>
          </div>

          <div class="st2-details__panel">
            <div class="st2-details__panel-heading">
              <h2 class="st2-details__panel-title">Trigger</h2>
            </div>
            <div class="st2-manual-form st2-form-combobox"
              name="trigger"
              spec="triggerSuggestionSpec"
              ng-enums="triggerSuggestionSpec.enum"
              disabled="!$root.state.params.edit"
              ng-model="rule.trigger.type">
            </div>
            <div class="st2-details__panel-body"
                ng-switch="form.trigger.$valid">
              <div class="st2-auto-form__description"
                  ng-switch-when="false">
                Pick valid trigger from the list to see its parameters.
              </div>
              <div class="st2-auto-form"
                ng-switch-default
                spec="triggerSchema"
                disabled="!$root.state.params.edit"
                result="rule.trigger.parameters">
              </div>
            </div>
          </div>

          <div class="st2-details__panel">
            <div class="st2-details__panel-heading">
              <h2 class="st2-details__panel-title">Criteria</h2>
            </div>
            <div class="st2-details__panel-body">

              <div class="st2-criteria"
                model="rule.criteria"
                disabled="!$root.state.params.edit">
              </div>

            </div>
          </div>

          <div class="st2-details__panel">
            <div class="st2-details__panel-heading">
              <h2 class="st2-details__panel-title">Action</h2>
            </div>
            <div class="st2-manual-form st2-form-combobox"
              name="action"
              spec="actionSuggestionSpec"
              ng-enums="actionSuggestionSpec.enum"
              disabled="!$root.state.params.edit"
              ng-model="rule.action.ref">
            </div>
            <div class="st2-details__panel-body"
                ng-switch="form.action.$valid">
              <div class="st2-auto-form__description"
                  ng-switch-when="false">
                Pick valid action from the list to see its parameters.
              </div>
              <div class="st2-auto-form"
                spec="actionSchema"
                disabled="!$root.state.params.edit"
                result="rule.action.parameters">
              </div>
            </div>
          </div>

          <div class="st2-manual-form st2-form-checkbox"
            name="enabled"
            disabled="!$root.state.params.edit"
            ng-model="rule.enabled">
          </div>

        </div>
      </div>

      <div class="st2-details__body"
          ng-class="{'st2-details__body--active': $root.isState('^.code')}">
        <div class="st2-panel__scroller">

        <div class="st2-highlight" code="rule | json" lines="20"></div>

        </div>
      </div>

    </form>

  </div>

</main>

<div class="st2-report"></div>
